# Пример pipeline

Пример типового pipeline для обработки файла данных. На вход подается файл parquet, на выходе также формируется parquet файл, чаще такой же структуры.

Задача решается построением двух заимосвязанных процессов, процесса обучения модели и процесса прогнозирования. Общая схема представлена в файле `схема pipeline.drawio`. Схема в формате drawio, инструкция по просмотру схем находится в файле 'readme.md'.

## Описание процессов

*Процесс тренировки модели*

1. Формирование входного файла 

На схеме блок входных данных "входные данные для обучения, файл в формате parquet на S3". Пример формирования тестовых данных находится здесь: `docs/examples/parquet/create_parquet.ipynb`

2. Подготовка данных

На схеме подпрограмма подготовки данных пригодных для ML (машинное обучение) обработки отражена в виде блока "обработка данных". 

На вход программы подается файл parquet. Программа формирует промежуточные данные для отображения на витринах и данные пригодные для обработки пакетами машинного обучения (ML).

Запись данных для витрин можно вести в БД greenplum. Примеры записи в таблицы greenplum находятся здесь `docs/examples/greenplum/table_fill.ipynb`.

Запись данных, для последующей обработки, можно вести в БД tarntool. Примеры записи в таблицы tarantool находятся здесь `docs/examples/tarantool/table_fill.ipynb`

3. Машинное обучение

На схеме подпрограмма машинного обучения отображена в виде блока "тренировка данных".

На вход программы подются заранее подготовленные данные пригодные для обработки в ML-пакетах (Tensorflow, pytorch, ...). 

На выходе программы формируется файл модели. Файл модели записывается в систему управления моделями Mlflow. Примеры работы с mlflow находятся здесь `docs/examples/mlflow`.

4. Построение витрины данных

Витрина входных данных является неотъемлемой части машинного обучения. Витрина подробно показывает какие данные подавались на вход модели. Инструкция по разработки витрин находится здесь `docs/инструкции/инструкция по разработке витрин/инструкция по разработке витрин.md`.

*Процесс предсказания*

1. Формирование входного файла 

На схеме блок входных данных "входные данные для предсказани, файл в формате parquet на S3". Пример формирования тестовых данных находится здесь: `docs/examples/parquet/create_parquet.ipynb`.

Входной файл не должен полностью соотвествовать входному файла процесса обучения, это будет противоречить базовым принципам машинного обучения ML.

2. Подготовка данных

На схеме подпрограмма подготовки данных пригодных для ML (машинное обучение) обработки отражена в виде блока "обработка данных". В некоторых случаях, алгоритм обработки входных даных может в точности совпадать с аналогичным блоком процесса тренировки модели.

На вход программы подается файл parquet. Программа формирует промежуточные данные для отображения на витринах и данные пригодные для обработки пакетами машинного обучения (ML).

Запись данных для витрин можно вести в БД greenplum. Примеры записи в таблицы greenplum находятся здесь `docs/examples/greenplum/table_fill.ipynb`.

Запись данных, для последующей обработки, можно вести в БД tarntool. Примеры записи в таблицы tarantool находятся здесь `docs/examples/tarantool/table_fill.ipynb`

3. Предсказание

На схеме подпрограмма получения предсказанных данных отображена в виде блока "предсказание".

На вход программы подются заранее подготовленные данные пригодные для обработки в ML-пакетах (Tensorflow, pytorch, ...).  Программа находит нужную модель в MLflow. Нужно обратить внимание, что моделей может быть несколько, по некоторому заданному алгоритму находится наиболее оптимальная.

На выходе программы формируется файл parquet содержащий результаты прогнозирования. Разные задачи могут потребовать формировать собственные структуры выходных данных, но в любом случае должна прослеживаться логическая связь с входным файлом. Например, сымый простой случай, по результам работы модели входной файл фильтруется и получается выходной файл.

4. Построение витрины данных

Витрина входных данных является неотъемлемой части машинного обучения. Витрина подробно показывает какие данные подавались на вход модели.

Витрина выходных данных является неотъемлемой части машинного обучения. Витрина подробно показывает какие выходные данные сформированы. И самое главное, витрина показывает логическую взаимосвязь между входными и выходными данными.

 Инструкция по разработки витрин находится здесь `docs/инструкции/инструкция по разработке витрин/инструкция по разработке витрин.md`.


## Объединение процессов

После того как были сформированы необходимые программы, все они должны быть проверены и объеденены в единый работоспособный комплекс pipeline. Комплекс должен обеспечивать постулат: Любой может взять программы, описание и повторить результаты.

*Тестирование*

Перед тем как программы будут объедены в pipeline они должны быть проверены, должно обеспечиваться необходимое качество программного кода. Качество программного кода достигается прохождением заданных тестов.

Инструкция по созданию тестов находится здесь `docs\инструкции\инструкция по тестированию\инструкция по тестированию.md`.

*Формирование airflow dag*

Набор программ обретает комплексный вид, после того как будет выстроен общий конвеер обработки pipeline. Для построения pipeline применяются airflow dag's. Процессы тренировки модели и предсказания, в общем случае могут выполняться раздельно, а потому, рекомендуется создавать два независимых задания airflow dag.

Примеры формирования заданий airflow находятся здесь `docs/examples/airflow`.

## Документирование

{в процессе}

